<?php 
 include('../../connexion/connexion1.php');
//Création requete pour la liste des villes
 $sql3 = "SELECT * FROM région order by Nom_Region  ";
 $query3 = mysql_query($sql3) or die('Erreur ville l'.mysql_error());

//Création requete pour la liste des gens
 $sql4 = "SELECT * FROM province order by Nom_Province";
 $query4 = mysql_query($sql4) or die('Erreur Gens '.mysql_error());
?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
 <html xmlns="http://www.w3.org/1999/xhtml">
 <head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
 <title>Untitled Document</title>
 <script>
 function Lien() {
	i = document.Choix.Liste.selectedIndex;
	if (i == 0) return;
	url = document.Choix.Liste.options[i].value;
	parent.location.href = url;
}
 </script>
 <script type="text/javascript">
/*--------------------------------*/
 /* Renvoie handle DOM ( A ne pas changer !) */
 /*--------------------------------*/
 function findObj(id)
 {
 if (document.getElementById) {
 return (document.getElementById(id));
 }
 else if (document.all) {
 return (document.all[id]);
 }
 else if (document.layers) {
 return (document.layers[id]);
 }
 return null;
 }
/*--------------------------------*/
 /* Report du resultat ( A ne pas changer !) */
 /*--------------------------------*/
 function resReport(ex)
 {
 var box = findObj('result');
 if (!box)
 {
 var divs = findObj('super');
 box = document.createElement('div');
 box.setAttribute("id", "result");
 box.className = "err_app";
 if (divs) divs.appendChild(box);
 else document.body.appendChild(box);
 }
 if (ex instanceof Error) 
 {
 box.innerHTML = ex.name+" : "+ex.message;
 }
 else if (typeof ex == 'string') {
 box.innerHTML = ex;
 }
 }
 /*--------------------------------*/
 /* Formate le Post du Formulaire */
 /*--------------------------------*/
 function getQueryString(region) 
 {
 qstr = 'Region=' + encodeURIComponent(region);
 return qstr;
 }

/*---------------------------------*/
 /* Affiche le résultat Text Result */
 /*---------------------------------*/
 function updateText(xml) {
 var status = parseInt(xml.getElementsByTagName('status')[0].firstChild.nodeValue);
 // Erreur
 if (status == 0) {
 var reponse = xml.getElementsByTagName('reponse')[0].firstChild.nodeValue;
 resReport(reponse);
 return false;
 }
 // Traitement
 var reponse = xml.getElementsByTagName('reponse')[0].firstChild.data;
 var td = findObj("Province");
 td.innerHTML = reponse; 
 }
/*------------------------------*/
 /* Dialogue avec le Serveur */
 /*------------------------------*/
 function xmlhttpPost(region) 
 {
 try {
 var xhr = false;
 var self = this;
 var strURL = "extraction.php";

 if (window.XMLHttpRequest) 
 self.xhr = new XMLHttpRequest();
 else self.xhr = new ActiveXObject("Microsoft.XMLHTTP");
 self.xhr.open('POST', strURL, true);
 self.xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
 self.xhr.onreadystatechange = function() {
 if (self.xhr.readyState == 4 && self.xhr.status == 200) {
 updateText(self.xhr.responseXML);
 }
 if (self.xhr.readyState == 4 && self.xhr.status != 200) {
 resReport("<p><font color='RED'>Erreur " + strURL + " : " + self.xhr.statusText+"</font></p>");
 }
 }
 self.xhr.send(getQueryString(region));
 }
 catch (ex) {
 resReport(ex);
 return false
 }
 }
</script>
 </head>
 <body>
 <form name="frmSelect" action="Afficher_par_region.php" method="POST" enctype="multipart/form-data">
 <table width="60%" align="center">
 <tr>
 <th>
 Sélection : 
 </th>
 <td>
 Region<br />
 <select size="1" name="Region" onChange="xmlhttpPost(this.value)">
<?php // Selection de la région
 $sql = "SELECT * FROM région ORDER BY Nom_Region  ";
 $result = mysql_query($sql);
 print ("<option value='0'>Toutes Regions</option>\n");
 while ($bres = mysql_fetch_object($result)) {
 print ("<option value='$bres->Code_Region'>$bres->Nom_Region</option>\n");
 }
 ?>
 </select>
 </td>
 <td id="Province">
 Province<br />
 <select size="1" name="Province">
 <?php // Selection du Province
$sql = "SELECT * FROM Province WHERE Code_Region= $Code_Region ORDER BY Nom_Province";
 $result = mysql_query($sql);
 print ("<option value='0'>Province</option>\n");
 while ($bres = mysql_fetch_object($result)) {
 print ("<option value='$bres->Code_Province'>$bres->Nom_Province</option>\n"); 
 }
 ?>
 </select>
 </td>
</tr>
<tr><td><br></td></tr>
<tr>
	<td></td>
		<td></td>

 <td>
<input type="submit" class="btn btn-primary" value="Afficher">  </td>
 </tr>
 </table>
 </form>
 </body>
 </html>
